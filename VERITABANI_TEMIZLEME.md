# Sorumlu Tablosu - Ãœnvan Kolonu Temizleme

## Durum

- âœ… **Backend Entity**: Eski `unvan` alanÄ± kaldÄ±rÄ±ldÄ±
- âœ… **Backend DTO**: GÃ¼ncel `List<String> unvanlar` kullanÄ±lÄ±yor
- âš ï¸ **VeritabanÄ±**: Eski `unvan` kolonu hala var olabilir (Hibernate ddl-auto=update eski kolonlarÄ± silmez)

## Temizleme SeÃ§enekleri

### SeÃ§enek 1: VeritabanÄ±nÄ± SÄ±fÄ±rla (Ã–nerilen - Test OrtamÄ± Ä°Ã§in)

**Avantaj:** Temiz baÅŸlangÄ±Ã§, tÃ¼m eski kolonlar kaldÄ±rÄ±lÄ±r
**Dezavantaj:** TÃ¼m veri silinir

```bash
# Backend'i durdur
# Terminal'de:
cd C:\Users\MET\Training_Tracking

# H2 database dosyalarÄ±nÄ± sil
del .\data\egitim_takip_dev.mv.db
del .\data\egitim_takip_dev.trace.db

# Backend'i yeniden baÅŸlat
mvn spring-boot:run
```

**SonuÃ§:**
- TÃ¼m tablolar sÄ±fÄ±rdan oluÅŸturulur
- `sorumlu` tablosunda sadece yeni alanlar olur (unvan yok, unvanlar var)
- `sorumlu_unvanlar` tablosu otomatik oluÅŸturulur

---

### SeÃ§enek 2: Manuel SQL ile Kolonu Sil

**Avantaj:** Mevcut veri korunur
**Dezavantaj:** Manuel iÅŸlem

#### AdÄ±mlar:

1. **H2 Console'a gir:**
   ```
   http://localhost:8080/h2-console
   
   JDBC URL: jdbc:h2:file:./data/egitim_takip_dev
   Username: sa
   Password: (boÅŸ)
   ```

2. **Eski kolonu sil:**
   ```sql
   ALTER TABLE sorumlu DROP COLUMN IF EXISTS unvan;
   ```

3. **Kontrol et:**
   ```sql
   SELECT * FROM INFORMATION_SCHEMA.COLUMNS 
   WHERE TABLE_NAME = 'SORUMLU';
   ```

4. **Beklenen Kolonlar:**
   - `ID`
   - `AD`
   - `SOYAD`
   - `EMAIL`
   - `TELEFON`
   - âŒ `UNVAN` (olmamalÄ±)

5. **Yeni tablo kontrol:**
   ```sql
   SELECT * FROM sorumlu_unvanlar;
   ```

---

### SeÃ§enek 3: Flyway Migration (Production Ä°Ã§in)

**Avantaj:** Profesyonel, versiyonlanmÄ±ÅŸ veritabanÄ± deÄŸiÅŸiklikleri
**Dezavantaj:** Kurulum gerektirir

Migration dosyasÄ±: `src/main/resources/db/migration/V2__drop_sorumlu_unvan_column.sql`

```sql
-- Eski unvan kolonunu kaldÄ±r
ALTER TABLE sorumlu DROP COLUMN IF EXISTS unvan;
```

---

## Ã–nerilen AkÄ±ÅŸ (Test OrtamÄ±)

1. âœ… Backend entity zaten gÃ¼ncel (unvan yok, unvanlar var)
2. âœ… Frontend zaten multi-select kullanÄ±yor
3. ğŸ”„ **Åimdi yapÄ±lacak:** VeritabanÄ±nÄ± temizle

**En HÄ±zlÄ± YÃ¶ntem:**

```bash
# Backend'i durdur (Ctrl+C)
del .\data\*.db
mvn spring-boot:run
```

**SonuÃ§:**
```
Hibernate: create table sorumlu (
    id bigint generated by default as identity,
    ad varchar(100) not null,
    soyad varchar(100) not null,
    email varchar(200),
    telefon varchar(20),
    primary key (id)
)

Hibernate: create table sorumlu_unvanlar (
    sorumlu_id bigint not null,
    unvan varchar(100)
)

Hibernate: alter table sorumlu_unvanlar 
    add constraint FK_sorumlu_unvanlar_sorumlu_id 
    foreign key (sorumlu_id) references sorumlu
```

âœ… ArtÄ±k `sorumlu` tablosunda `unvan` kolonu yok!
âœ… `sorumlu_unvanlar` tablosu birden fazla Ã¼nvan iÃ§in kullanÄ±lÄ±yor!

---

## Test

### Backend API Testi:

```bash
curl -X POST http://localhost:8080/sorumlu \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "ad": "Test",
    "soyad": "User",
    "email": "test@test.com",
    "telefon": "0555 555 5555",
    "unvanlar": [
      "MÃ¼fredat Sorumlusu",
      "Proje Sorumlusu"
    ]
  }'
```

### VeritabanÄ± Testi:

```sql
-- H2 Console'da:
SELECT 
    s.id,
    s.ad,
    s.soyad,
    u.unvan
FROM sorumlu s
LEFT JOIN sorumlu_unvanlar u ON s.id = u.sorumlu_id;
```

**Beklenen:**
```
id | ad   | soyad | unvan
---|------|-------|-------------------
1  | Test | User  | MÃ¼fredat Sorumlusu
1  | Test | User  | Proje Sorumlusu
```

---

## Ä°puÃ§larÄ±

- âš ï¸ **Ãœretim ortamÄ±nda:** Flyway migration kullanÄ±n
- âœ… **Test ortamÄ±nda:** Database dosyalarÄ±nÄ± silip temiz baÅŸlayÄ±n
- ğŸ“Š **Veri kaybÄ± istemiyorsanÄ±z:** Manuel SQL ile kolonu silin
- ğŸ”„ **DÃ¼zenli geliÅŸtirmede:** Her bÃ¼yÃ¼k deÄŸiÅŸiklikte database'i sÄ±fÄ±rlayÄ±n


